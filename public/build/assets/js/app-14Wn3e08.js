import{Q as e,h as n,E as t}from"./vendor-utils-Bo3JNC9L.js";import"./vendor-CHzDFH9V.js";class o{constructor(){this.currentTemplate=null,this.currentMiembro=null,this.personalizacion=null,this.init()}init(){this.bindEvents(),this.loadTemplates(),this.initializeColorPickers(),this.initializeQRGenerator(),this.initializePDFGenerator()}bindEvents(){document.addEventListener("click",e=>{e.target.closest(".template-card")&&this.selectTemplate(e.target.closest(".template-card"))}),document.addEventListener("change",e=>{e.target.matches('.carnet-color-input input[type="color"]')&&this.updateColors(),e.target.matches(".carnet-typography-controls input, .carnet-typography-controls select")&&this.updateTypography(),e.target.matches(".carnet-data-controls input, .carnet-data-controls textarea")&&this.updateData()}),document.addEventListener("click",e=>{e.target.closest(".carnet-color-option")&&this.selectColorPalette(e.target.closest(".carnet-color-option"))}),document.addEventListener("click",e=>{e.target.matches(".carnet-btn-primary")&&this.savePersonalization(),e.target.matches(".carnet-btn-success")&&this.generateCarnet(),e.target.matches(".carnet-pdf-btn-primary")&&this.generatePDF()})}loadTemplates(){fetch("/api/carnet/templates").then(e=>e.json()).then(e=>{this.renderTemplates(e)}).catch(e=>{})}renderTemplates(e){const n=document.querySelector(".carnet-templates-container");n&&(n.innerHTML=e.map(e=>`\n            <div class="template-card" data-template-id="${e.id}">\n                <div class="template-preview">\n                    <div class="carnet-preview ${e.template_path.replace(".","-")}">\n                        \x3c!-- Vista previa de la plantilla --\x3e\n                    </div>\n                </div>\n                <div class="template-info">\n                    <h5>${e.nombre}</h5>\n                    <p>${e.descripcion}</p>\n                    <button class="btn btn-primary btn-sm">Seleccionar</button>\n                </div>\n            </div>\n        `).join(""))}selectTemplate(e){document.querySelectorAll(".template-card").forEach(e=>{e.classList.remove("selected")}),e.classList.add("selected");const n=e.dataset.templateId;this.currentTemplate=n,this.loadTemplateData(n)}loadTemplateData(e){fetch(`/api/carnet/templates/${e}`).then(e=>e.json()).then(n=>{this.renderTemplatePreview(n),this.loadPersonalization(e)}).catch(e=>{})}renderTemplatePreview(e){const n=document.querySelector(".carnet-preview-container");n&&(n.innerHTML=`\n            <div class="carnet-base ${e.template_path.replace(".","-")}" id="carnet-preview">\n                \x3c!-- Contenido del carnet se renderiza dinámicamente --\x3e\n            </div>\n        `,this.updatePreview())}loadPersonalization(e){var n;const t=null==(n=document.querySelector("[data-miembro-id]"))?void 0:n.dataset.miembroId;t&&fetch(`/api/carnet/personalizacion/${t}/${e}`).then(e=>e.json()).then(e=>{this.personalizacion=e,this.applyPersonalization()}).catch(e=>{})}applyPersonalization(){this.personalizacion&&(document.querySelectorAll('.carnet-color-input input[type="color"]').forEach(e=>{const n=e.name;this.personalizacion[n]&&(e.value=this.personalizacion[n])}),document.querySelectorAll(".carnet-typography-controls input, .carnet-typography-controls select").forEach(e=>{const n=e.name;void 0!==this.personalizacion[n]&&(e.value=this.personalizacion[n])}),this.personalizacion.datos_personalizados&&Object.entries(this.personalizacion.datos_personalizados).forEach(([e,n])=>{const t=document.querySelector(`[name="${e}"]`);t&&(t.value=n)}),this.updatePreview())}updateColors(){var e,n,t,o;const r=null==(e=document.querySelector('input[name="color_primario"]'))?void 0:e.value;null==(n=document.querySelector('input[name="color_secundario"]'))||n.value;const a=null==(t=document.querySelector('input[name="color_fondo"]'))?void 0:t.value,i=null==(o=document.querySelector('input[name="color_texto"]'))?void 0:o.value,c=document.querySelector("#carnet-preview");if(c){const e=c.querySelector(".carnet-header");e&&(e.style.background=r);const n=c.querySelector(".carnet-body");n&&(n.style.background=a,n.style.color=i);const t=c.querySelector(".carnet-status-badge");t&&(t.style.background=r);c.querySelectorAll(".carnet-date-value").forEach(e=>{e.style.color=r})}}updateTypography(){var e,n,t,o,r,a,i,c;const l=null==(e=document.querySelector('input[name="tamaño_nombre"]'))?void 0:e.value,u=null==(n=document.querySelector('input[name="tamaño_profesion"]'))?void 0:n.value,s=null==(t=document.querySelector('input[name="tamaño_organizacion"]'))?void 0:t.value,d=null==(o=document.querySelector('select[name="fuente_familia"]'))?void 0:o.value,m=null==(r=document.querySelector('input[name="nombre_negrita"]'))?void 0:r.checked,p=null==(a=document.querySelector('input[name="nombre_cursiva"]'))?void 0:a.checked,v=null==(i=document.querySelector('input[name="profesion_negrita"]'))?void 0:i.checked,y=null==(c=document.querySelector('input[name="profesion_cursiva"]'))?void 0:c.checked,h=document.querySelector("#carnet-preview");if(h){h.style.fontFamily=d;const e=h.querySelector("#carnet-nombre-preview");e&&(e.style.fontSize=`${l}px`,e.style.fontWeight=m?"bold":"normal",e.style.fontStyle=p?"italic":"normal");const n=h.querySelector("#carnet-profesion-preview");n&&(n.style.fontSize=`${u}px`,n.style.fontWeight=v?"bold":"normal",n.style.fontStyle=y?"italic":"normal");const t=h.querySelector("#carnet-organizacion-preview");t&&(t.style.fontSize=`${s}px`)}}updateData(){var e,n,t,o;const r=null==(e=document.querySelector('input[name="nombre"]'))?void 0:e.value,a=null==(n=document.querySelector('input[name="profesion"]'))?void 0:n.value,i=null==(t=document.querySelector('input[name="organizacion"]'))?void 0:t.value,c=null==(o=document.querySelector('input[name="numero_carnet"]'))?void 0:o.value,l=document.querySelector("#carnet-preview");if(l){const e=l.querySelector("#carnet-nombre-preview"),n=l.querySelector("#carnet-profesion-preview"),t=l.querySelector("#carnet-organizacion-preview"),o=l.querySelector("#carnet-numero-preview");e&&(e.textContent=r),n&&(n.textContent=a),t&&(t.textContent=i),o&&(o.textContent=c)}}updatePreview(){this.updateColors(),this.updateTypography(),this.updateData(),this.generateQR()}selectColorPalette(e){document.querySelectorAll(".carnet-color-option").forEach(e=>{e.classList.remove("active")}),e.classList.add("active");const n=e.dataset.primary,t=e.dataset.secondary;if(n){const e=document.querySelector('input[name="color_primario"]');e&&(e.value=n)}if(t){const e=document.querySelector('input[name="color_secundario"]');e&&(e.value=t)}this.updatePreview()}initializeColorPickers(){const e=document.querySelector(".carnet-color-palette");e&&(e.innerHTML='\n                <div class="carnet-color-option" data-primary="#4facfe" data-secondary="#00f2fe">\n                    <div class="carnet-color-preview carnet-palette-azul"></div>\n                    <span class="carnet-color-name">Azul-Cian</span>\n                </div>\n                <div class="carnet-color-option" data-primary="#43e97b" data-secondary="#38f9d7">\n                    <div class="carnet-color-preview carnet-palette-verde"></div>\n                    <span class="carnet-color-name">Verde</span>\n                </div>\n                <div class="carnet-color-option" data-primary="#fa709a" data-secondary="#fee140">\n                    <div class="carnet-color-preview carnet-palette-rosa"></div>\n                    <span class="carnet-color-name">Rosa-Amarillo</span>\n                </div>\n                <div class="carnet-color-option" data-primary="#667eea" data-secondary="#764ba2">\n                    <div class="carnet-color-preview carnet-palette-purple"></div>\n                    <span class="carnet-color-name">Púrpura</span>\n                </div>\n                <div class="carnet-color-option" data-primary="#f093fb" data-secondary="#f5576c">\n                    <div class="carnet-color-preview carnet-palette-orange"></div>\n                    <span class="carnet-color-name">Rosa-Rojo</span>\n                </div>\n                <div class="carnet-color-option" data-primary="#008080" data-secondary="#00ced1">\n                    <div class="carnet-color-preview carnet-palette-teal"></div>\n                    <span class="carnet-color-name">Teal</span>\n                </div>\n            ')}initializeQRGenerator(){this.qrConfig={width:120,height:120,color:{dark:"#000000",light:"#ffffff"},errorCorrectionLevel:"M"}}generateQR(){const n=document.querySelector("#carnet-qr-code");if(!n)return;const t=this.getQRData();n.innerHTML="",e.toCanvas(n,t,this.qrConfig).then(()=>{}).catch(e=>{n.innerHTML='<div style="text-align: center; color: #666; font-size: 10px;">QR no disponible</div>'})}getQRData(){var e,n;const t=null==(e=document.querySelector("[data-miembro-id]"))?void 0:e.dataset.miembroId,o=null==(n=document.querySelector('input[name="numero_carnet"]'))?void 0:n.value;return JSON.stringify({miembro_id:t,numero_carnet:o,url:`${window.location.origin}/miembros/${t}`,timestamp:(new Date).toISOString()})}initializePDFGenerator(){this.pdfConfig={format:"a4",orientation:"portrait",quality:"high"}}generatePDF(){const e=document.querySelector("#carnet-preview");e?(this.showPDFProgress(),n(e,{scale:2,useCORS:!0,allowTaint:!0,backgroundColor:null}).then(e=>{var n;const o=e.toDataURL("image/png"),r=new t({orientation:"portrait",unit:"mm",format:"a4"}),a=210*e.height/e.width;let i=a,c=0;for(r.addImage(o,"PNG",0,c,210,a),i-=295;i>=0;)c=i-a,r.addPage(),r.addImage(o,"PNG",0,c,210,a),i-=295;const l=`carnet-${(null==(n=window.carnetMiembro)?void 0:n.id)||"miembro"}-${Date.now()}.pdf`;r.save(l),this.hidePDFProgress(),this.showNotification("PDF generado exitosamente","success")}).catch(e=>{this.hidePDFProgress(),this.showNotification("Error generando PDF. Intenta nuevamente.","error")})):this.showNotification("Error: No se encontró el elemento del carnet","error")}showPDFProgress(){const e=document.querySelector(".carnet-pdf-progress");e&&e.classList.add("show")}hidePDFProgress(){const e=document.querySelector(".carnet-pdf-progress");e&&e.classList.remove("show")}savePersonalization(){var e,n,t,o,r,a,i,c,l,u,s,d,m,p,v,y,h,f;const S=null==(e=window.carnetMiembro)?void 0:e.id;if(!S)return void this.showNotification("Error: No se encontró el ID del miembro","error");const g={template_id:this.currentTemplate,color_primario:null==(n=document.querySelector('input[name="color_primario"]'))?void 0:n.value,color_secundario:null==(t=document.querySelector('input[name="color_secundario"]'))?void 0:t.value,color_fondo:null==(o=document.querySelector('input[name="color_fondo"]'))?void 0:o.value,color_texto:null==(r=document.querySelector('input[name="color_texto"]'))?void 0:r.value,fuente_familia:null==(a=document.querySelector('select[name="fuente_familia"]'))?void 0:a.value,"tamaño_nombre":null==(i=document.querySelector('input[name="tamaño_nombre"]'))?void 0:i.value,"tamaño_profesion":null==(c=document.querySelector('input[name="tamaño_profesion"]'))?void 0:c.value,"tamaño_organizacion":null==(l=document.querySelector('input[name="tamaño_organizacion"]'))?void 0:l.value,nombre_negrita:null==(u=document.querySelector('input[name="nombre_negrita"]'))?void 0:u.checked,nombre_cursiva:null==(s=document.querySelector('input[name="nombre_cursiva"]'))?void 0:s.checked,profesion_negrita:null==(d=document.querySelector('input[name="profesion_negrita"]'))?void 0:d.checked,profesion_cursiva:null==(m=document.querySelector('input[name="profesion_cursiva"]'))?void 0:m.checked,datos_personalizados:{nombre:null==(p=document.querySelector('input[name="nombre"]'))?void 0:p.value,profesion:null==(v=document.querySelector('input[name="profesion"]'))?void 0:v.value,organizacion:null==(y=document.querySelector('input[name="organizacion"]'))?void 0:y.value,numero_carnet:null==(h=document.querySelector('input[name="numero_carnet"]'))?void 0:h.value}};fetch(`/carnet/${S}/personalizar`,{method:"POST",headers:{"Content-Type":"application/json","X-CSRF-TOKEN":null==(f=document.querySelector('meta[name="csrf-token"]'))?void 0:f.content},body:JSON.stringify(g)}).then(e=>e.json()).then(e=>{e.success?this.showNotification("Personalización guardada correctamente","success"):this.showNotification("Error guardando personalización","error")}).catch(e=>{this.showNotification("Error guardando personalización","error")})}generateCarnet(){var e;const n=null==(e=window.carnetMiembro)?void 0:e.id,t=this.currentTemplate;if(!n||!t)return void this.showNotification("Selecciona una plantilla primero","warning");const o=`/carnet/${n}/generar/${t}`;window.open(o,"_blank")}showNotification(e,n="info"){const t=document.createElement("div");t.className=`alert alert-${"error"===n?"danger":n} alert-dismissible fade show`,t.innerHTML=`\n            ${e}\n            <button type="button" class="btn-close" data-bs-dismiss="alert"></button>\n        `,document.body.appendChild(t),setTimeout(()=>{t.remove()},5e3)}}document.addEventListener("DOMContentLoaded",()=>{window.carnetSystem=new o});let r=null,a=null;function i(){var e,n,t,o;const r=null==(e=document.querySelector('input[name="color_primario"]'))?void 0:e.value;null==(n=document.querySelector('input[name="color_secundario"]'))||n.value;const a=null==(t=document.querySelector('input[name="color_fondo"]'))?void 0:t.value,i=null==(o=document.querySelector('input[name="color_texto"]'))?void 0:o.value,c=document.querySelector("#carnet-preview");if(c){const e=c.querySelector(".carnet-header");e&&(e.style.background=r);const n=c.querySelector(".carnet-body");n&&(n.style.background=a,n.style.color=i);const t=c.querySelector(".carnet-status-badge");t&&(t.style.background=r);c.querySelectorAll(".carnet-date-value").forEach(e=>{e.style.color=r})}}function c(){var e,n,t,o,r,a,i,c;const l=null==(e=document.querySelector('input[name="tamaño_nombre"]'))?void 0:e.value,u=null==(n=document.querySelector('input[name="tamaño_profesion"]'))?void 0:n.value,s=null==(t=document.querySelector('input[name="tamaño_organizacion"]'))?void 0:t.value,d=null==(o=document.querySelector('select[name="fuente_familia"]'))?void 0:o.value,m=null==(r=document.querySelector('input[name="nombre_negrita"]'))?void 0:r.checked,p=null==(a=document.querySelector('input[name="nombre_cursiva"]'))?void 0:a.checked,v=null==(i=document.querySelector('input[name="profesion_negrita"]'))?void 0:i.checked,y=null==(c=document.querySelector('input[name="profesion_cursiva"]'))?void 0:c.checked,h=document.querySelector("#carnet-preview");if(h){h.style.fontFamily=d;const e=h.querySelector("#carnet-nombre-preview");e&&(e.style.fontSize=`${l}px`,e.style.fontWeight=m?"bold":"normal",e.style.fontStyle=p?"italic":"normal");const n=h.querySelector("#carnet-profesion-preview");n&&(n.style.fontSize=`${u}px`,n.style.fontWeight=v?"bold":"normal",n.style.fontStyle=y?"italic":"normal");const t=h.querySelector("#carnet-organizacion-preview");t&&(t.style.fontSize=`${s}px`)}}function l(){var e,n,t,o;const r=null==(e=document.querySelector('input[name="nombre"]'))?void 0:e.value,a=null==(n=document.querySelector('input[name="profesion"]'))?void 0:n.value,i=null==(t=document.querySelector('input[name="organizacion"]'))?void 0:t.value,c=null==(o=document.querySelector('input[name="numero_carnet"]'))?void 0:o.value,l=document.querySelector("#carnet-preview");if(l){const e=l.querySelector("#carnet-nombre-preview"),n=l.querySelector("#carnet-profesion-preview"),t=l.querySelector("#carnet-organizacion-preview"),o=l.querySelector("#carnet-numero-preview");e&&(e.textContent=r),n&&(n.textContent=a),t&&(t.textContent=i),o&&(o.textContent=c)}}function u(){const e=document.querySelector(".carnet-pdf-progress");e&&e.classList.remove("show")}function s(e,n="info"){const t=document.createElement("div");t.className=`alert alert-${"error"===n?"danger":n} alert-dismissible fade show position-fixed`,t.style.cssText="top: 20px; right: 20px; z-index: 9999; min-width: 300px;",t.innerHTML=`\n        ${e}\n        <button type="button" class="btn-close" data-bs-dismiss="alert"></button>\n    `,document.body.appendChild(t),setTimeout(()=>{t.remove()},5e3)}document.addEventListener("DOMContentLoaded",function(){void 0!==window.carnetMiembro&&(r=window.carnetMiembro,a=window.carnetTemplate,document.querySelectorAll('input[name="color_primario"], input[name="color_secundario"], input[name="color_fondo"], input[name="color_texto"]').forEach(e=>{e.addEventListener("input",i)}),document.querySelectorAll('input[name="tamaño_nombre"], input[name="tamaño_profesion"], input[name="tamaño_organizacion"], select[name="fuente_familia"]').forEach(e=>{e.addEventListener("change",c)}),document.querySelectorAll('input[name="nombre"], input[name="profesion"], input[name="organizacion"], input[name="numero_carnet"]').forEach(e=>{e.addEventListener("input",l)}),document.querySelectorAll('input[name="nombre_negrita"], input[name="nombre_cursiva"], input[name="profesion_negrita"], input[name="profesion_cursiva"]').forEach(e=>{e.addEventListener("change",c)}),document.querySelectorAll(".carnet-color-option").forEach(e=>{e.addEventListener("click",function(){!function(e){document.querySelectorAll(".carnet-color-option").forEach(e=>{e.classList.remove("active")}),e.classList.add("active");const n=e.dataset.primary,t=e.dataset.secondary;if(n){const e=document.querySelector('input[name="color_primario"]');e&&(e.value=n)}if(t){const e=document.querySelector('input[name="color_secundario"]');e&&(e.value=t)}i()}(this)})}),function(){var e,n;const t=document.querySelector("#carnet-qr-code");if(!t)return;const o={miembro_id:null==r?void 0:r.id,numero_carnet:(null==(e=document.querySelector('input[name="numero_carnet"]'))?void 0:e.value)||(null==r?void 0:r.numero_carnet),nombre:(null==(n=document.querySelector('input[name="nombre"]'))?void 0:n.value)||(null==r?void 0:r.nombre_completo),url:`${window.location.origin}/miembros/${null==r?void 0:r.id}`,timestamp:(new Date).toISOString()};t.innerHTML="","undefined"!=typeof QRCode?QRCode.toCanvas(t,JSON.stringify(o),{width:104,height:104,margin:1,color:{dark:"#000000",light:"#ffffff"},errorCorrectionLevel:"M"}).then(()=>{}).catch(e=>{t.innerHTML='<div style="text-align: center; color: #666; font-size: 16px;">QR no disponible</div>'}):t.innerHTML='<div style="text-align: center; color: #666; font-size: 16px;">QR no disponible</div>'}())}),window.savePersonalization=function(){var e,n,t,o,i,c,l,u,d,m,p,v,y,h,f,S,g;const q=null==r?void 0:r.id;if(!q)return void s("Error: No se encontró el ID del miembro","error");const _={template_id:null==a?void 0:a.id,color_primario:null==(e=document.querySelector('input[name="color_primario"]'))?void 0:e.value,color_secundario:null==(n=document.querySelector('input[name="color_secundario"]'))?void 0:n.value,color_fondo:null==(t=document.querySelector('input[name="color_fondo"]'))?void 0:t.value,color_texto:null==(o=document.querySelector('input[name="color_texto"]'))?void 0:o.value,fuente_familia:null==(i=document.querySelector('select[name="fuente_familia"]'))?void 0:i.value,"tamaño_nombre":null==(c=document.querySelector('input[name="tamaño_nombre"]'))?void 0:c.value,"tamaño_profesion":null==(l=document.querySelector('input[name="tamaño_profesion"]'))?void 0:l.value,"tamaño_organizacion":null==(u=document.querySelector('input[name="tamaño_organizacion"]'))?void 0:u.value,nombre_negrita:null==(d=document.querySelector('input[name="nombre_negrita"]'))?void 0:d.checked,nombre_cursiva:null==(m=document.querySelector('input[name="nombre_cursiva"]'))?void 0:m.checked,profesion_negrita:null==(p=document.querySelector('input[name="profesion_negrita"]'))?void 0:p.checked,profesion_cursiva:null==(v=document.querySelector('input[name="profesion_cursiva"]'))?void 0:v.checked,datos_personalizados:{nombre:null==(y=document.querySelector('input[name="nombre"]'))?void 0:y.value,profesion:null==(h=document.querySelector('input[name="profesion"]'))?void 0:h.value,organizacion:null==(f=document.querySelector('input[name="organizacion"]'))?void 0:f.value,numero_carnet:null==(S=document.querySelector('input[name="numero_carnet"]'))?void 0:S.value}};fetch(`/carnet/${q}/personalizar`,{method:"POST",headers:{"Content-Type":"application/json","X-CSRF-TOKEN":null==(g=document.querySelector('meta[name="csrf-token"]'))?void 0:g.content},body:JSON.stringify(_)}).then(e=>e.json()).then(e=>{e.success?s("Personalización guardada correctamente","success"):s("Error guardando personalización","error")}).catch(e=>{s("Error guardando personalización","error")})},window.generateCarnet=function(){const e=null==r?void 0:r.id,n=null==a?void 0:a.id;if(!e||!n)return void s("Selecciona una plantilla primero","warning");const t=`/carnet/${e}/generar/${n}`;window.open(t,"_blank")},window.generatePDF=function(){const e=document.querySelector("#carnet-preview");e?(!function(){const e=document.querySelector(".carnet-pdf-progress");e&&e.classList.add("show")}(),"undefined"!=typeof html2canvas&&"undefined"!=typeof jsPDF?html2canvas(e,{scale:2,useCORS:!0,allowTaint:!0,backgroundColor:null}).then(e=>{const n=e.toDataURL("image/png"),t=new jsPDF({orientation:"portrait",unit:"mm",format:"a4"}),o=210*e.height/e.width;let a=o,i=0;for(t.addImage(n,"PNG",0,i,210,o),a-=295;a>=0;)i=a-o,t.addPage(),t.addImage(n,"PNG",0,i,210,o),a-=295;const c=`carnet-${(null==r?void 0:r.id)||"miembro"}-${Date.now()}.pdf`;t.save(c),u(),s("PDF generado exitosamente","success")}).catch(e=>{u(),s("Error generando PDF. Intenta nuevamente.","error")}):(u(),s("Error: Librerías de PDF no disponibles","error"))):s("Error: No se encontró el elemento del carnet","error")};export{o as C};
